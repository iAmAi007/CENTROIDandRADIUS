<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geographical Center Calculator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @font-face {
            font-family: 'SF Pro Display';
            src: url('SFPRODISPLAY-REGULAR.TTF') format('truetype');
            font-style: normal;
        }
        body {
            font-family: 'SF Pro Display', sans-serif;
            margin: 20px;
            font-size: 16px;
            color: #004185;
            letter-spacing: 0.6px;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        ::-webkit-input-placeholder{
            color: color-mix(in srgb, #ffffff 30%, #6cb4ef); /*lightening the said color by adding some percentage of white */
        }
        ::-ms-input-placeholder{
            color: color-mix(in srgb, #ffffff 30%, #6cb4ef); /*lightening the said color by adding some percentage of white */
        }
        ::-moz-input-placeholder{
            color: color-mix(in srgb, #ffffff 30%, #6cb4ef); /*lightening the said color by adding some percentage of white */
        }
        .container {
            max-width: 600px;
            width: 100%;
        }
        .input-container {
            margin-bottom: 0px;
        }
        .instruction {
            font-size: 16px;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .coordinate-row {
            display: flex;
            gap: 10px;
            width: 100%;
            flex-direction: row;
            padding-bottom: 20px;
            align-items: flex-start;
        }

        .coordinate-row input {
            flex: 75%;
            color: #004185;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #6cb4ef;
            border-radius: none;
        }

        .output {
            margin-top: 20px;
            padding: 10px;
            text-align: center;
            border: 1px solid #6cb4ef;
            border-radius: 0px;
            background-color: #004185;
            width: 100%;
            box-sizing: border-box;
        }
        #map {
            height: 400px;
            margin-top: 20px;
            border: 1px solid #6cb4ef;
            border-radius: 0px;
            width: 100%;
            box-sizing: border-box;
        }

    </style>
</head>
<body>
    <div class="container" style="border: 1px solid #6cb4ef; padding: 20px;";>
        <!--<h1>Geographical Center Calculation</h1>-->
        <div id="spacing" style="padding-top: 30px;"></div>
        <div class="instruction" style="text-align: justify; padding-bottom: 10px;"> 
            <p>This tool calculates the geographical center (centroid) of a given set of coordinates. You can input up to 10 points and visualize the area on a map.</p>
            <p><span style="font-weight: 500;">Accepted Input Formats:</span> decimal degrees: e.g <span style="color: #32cd32;"><code>37.7749</code>, <code>-122.4194</span>, </code>directional decimal degrees: e.g <span style="color: #ff00ff;"><code>37.7749N</code>, <code>122.4194W</span>, </code>degrees and minutes with direction: e.g <span style="color: #ff8c00;"><code>37°46'N</code>, <code>122°25'W</span>, </code>degrees, minutes without symbols: e.g <span style="color: red;"><code>04 45S</code>, <code>040 30E</span> and </code>degrees, minutes, seconds without symbols: e.g <span style="color: #00bfff;"><code>04 45 00S</code>, <code>040 30 00E</span>.</code></p>
            <p>Ensure the input format is consistent and valid. The latitude must range from <span style="color: #ff00ff;"><code>-90</code></span> to <span style="color: #ff00ff;"><code>90</code></span>, and the longitude must range from <span style="color: red;"><code>-180</code></span> to <span style="color: red;"><code>180</code></span>.</p>
        </div>

        <form id="coordinate-form">
            <div id="coordinate-fields" class="input-container">
                <div class="coordinate-row">
                    <input type="text" style="font-size: 16px; text-align: center;" placeholder="Latitude 1" id="latitude1" name="latitude1" required>
                    <input type="text" style="font-size: 16px; text-align: center;" placeholder="Longitude 1" id="longitude1" name="longitude1" required>
                </div>
            </div>
            <div id="buttonsContainer">
            <button type="button" onclick="addField()">Add more coordinates</button>
            <button type="button" onclick="calculateAndPlot()">Calculate and plot</button>
            <style>
                #buttonsContainer {
                    display: flex;
                    gap: 10px; /* Space between the buttons */
                    overflow: hidden;
                    width: 100%;
                    position: relative;
                    flex-direction: row;
                    padding-top: 0px;
                    box-sizing: border-box;
                }
                button {
                    gap: 10px; /* Space between the buttons */
                    overflow: hidden;
                    width: 100%;
                    position: relative;
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                    padding: 10px;
                    box-sizing: border-box;
                    cursor: pointer;
                    background: #0078d4; /* Match the Distance button color */
                    color: white;
                    border: none;
                    border-radius: 0px;
                    cursor: pointer;
                    font-size: 16px;
                    transition: background-color 0.3s ease
                }
                button:hover {
                        background: #1358BF;
                    }

                button:active {
                    background: #1358bf;
                    transform: translateY(1px);
                }

            </style>
            </div>
        </form>

        <div id="map"></div>
        <div class="output" style="background: white;"; id="output"></div>
        <div class="footer" style="text-align: center; color: #6cb4ef; font-size: 12px; background: white; padding:20px 0 20px 0;"; id="output">
            <p>© 2025 Albright Machumu & Brian Martin Kapolesya</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let coordinateCount = 1;
        let map, polygonLayer, centerMarker;

        // Initialize the map
        document.addEventListener("DOMContentLoaded", () => {
            map = L.map('map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
        });

        function addField() {
            coordinateCount++;
            if (coordinateCount > 10) {
                alert("Maximum of 10 coordinates allowed.");
                return;
            }
            const div = document.createElement("div");
            div.className = "coordinate-row";
            div.innerHTML = `
                <input type="text" style="font-size: 16px; text-align: center;" placeholder="Latitude ${coordinateCount}" id="latitude${coordinateCount}" name="latitude${coordinateCount}" required>
                <input type="text" style="font-size: 16px; text-align: center;" placeholder="Longitude ${coordinateCount}" id="longitude${coordinateCount}" name="longitude${coordinateCount}" required>
            `;
            document.getElementById("coordinate-fields").appendChild(div);
        }

        function parseCoordinate(value) {
            value = value.trim().toUpperCase();

            // Handle Degrees, Minutes, Seconds without symbols (e.g "04 45 00S")
            const dmsPattern = /^(\d+)\s+(\d+)\s+(\d+)([NSWE])$/;
            const dmsMatch = value.match(dmsPattern);
            if (dmsMatch) {
                const degrees = parseFloat(dmsMatch[1]);
                const minutes = parseFloat(dmsMatch[2]);
                const seconds = parseFloat(dmsMatch[3]);
                const direction = dmsMatch[4];
                let decimal = degrees + minutes / 60 + seconds / 3600;
                if (direction === 'S' || direction === 'W') {
                    decimal = -decimal;
                }
                return decimal;
            }

            // Handle Decimal Degrees (e.g "37.7749")
            const number = parseFloat(value);
            if (!isNaN(number)) {
                return number;
            }

            throw new Error("Invalid coordinate format.");
        }

        function calculateAndPlot() {
            try {
                const latitudes = [];
                const longitudes = [];
                const coordinates = [];

                for (let i = 1; i <= coordinateCount; i++) {
                    const lat = parseCoordinate(document.getElementById(`latitude${i}`).value);
                    const lon = parseCoordinate(document.getElementById(`longitude${i}`).value);
                    latitudes.push(lat);
                    longitudes.push(lon);
                    coordinates.push([lat, lon]);
                }

                const centerLatitude = latitudes.reduce((sum, lat) => sum + lat, 0) / latitudes.length;
                const centerLongitude = longitudes.reduce((sum, lon) => sum + lon, 0) / longitudes.length;

                document.getElementById("output").innerHTML = `
                    <p><strong>Center: (in different coordinates formats) </strong><span>${centerLatitude.toFixed(6)}, ${centerLongitude.toFixed(6)}</span></p>`;
  
                if (polygonLayer) {
                    map.removeLayer(polygonLayer);
                }
                if (centerMarker) {
                    map.removeLayer(centerMarker);
                }

                polygonLayer = L.polygon(coordinates, { color: 'blue' }).addTo(map);
                centerMarker = L.marker([centerLatitude, centerLongitude], { title: "Center" }).addTo(map);

                map.fitBounds(polygonLayer.getBounds());
            } catch (error) {
                alert(error.message);
            }
        }
    </script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const isMobile = /Mobi|Android|iPad|iPhone/i.test(navigator.userAgent) || window.innerWidth <= 768;
        if (isMobile) {
            document.body.innerHTML = `
                <div style="text-align: center; margin-top: 50px; font-family: "SF Pro Display">
                    <h2>Access Restricted</h2>
                    <p>This page is only accessible on desktop devices. Please use a computer to view this content.</p>
                </div>
            `;
        }
    });


    function parseCoordinate(value) {
        value = value.trim().toUpperCase();

        // Handle Degrees, Minutes without symbols (e.g., "04 45S")
        const dmPattern = /^(\d+)\s+(\d+)([NSWE])$/;
        const dmMatch = value.match(dmPattern);
        if (dmMatch) {
            const degrees = parseFloat(dmMatch[1]);
            const minutes = parseFloat(dmMatch[2]);
            const direction = dmMatch[3];
            let decimal = degrees + minutes / 60;
            if (direction === 'S' || direction === 'W') {
                decimal = -decimal;
            }
            return decimal;
        }

        // Existing parsing logic for other formats
        const dmsPattern = /^(\d+)\s+(\d+)\s+(\d+)([NSWE])$/;
        const dmsMatch = value.match(dmsPattern);
        if (dmsMatch) {
            const degrees = parseFloat(dmsMatch[1]);
            const minutes = parseFloat(dmsMatch[2]);
            const seconds = parseFloat(dmsMatch[3]);
            const direction = dmsMatch[4];
            let decimal = degrees + minutes / 60 + seconds / 3600;
            if (direction === 'S' || direction === 'W') {
                decimal = -decimal;
            }
            return decimal;
        }

        const number = parseFloat(value);
        if (!isNaN(number)) {
            return number;
        }

        throw new Error("Invalid coordinate format.");
    }

function calculateAndPlot() {
    try {
        const latitudes = [];
        const longitudes = [];
        const coordinates = [];

        // Collect input coordinates
        for (let i = 1; i <= coordinateCount; i++) {
            const lat = parseCoordinate(document.getElementById(`latitude${i}`).value);
            const lon = parseCoordinate(document.getElementById(`longitude${i}`).value);
            latitudes.push(lat);
            longitudes.push(lon);
            coordinates.push([lat, lon]);
        }

        // Calculate centroid
        const centerLatitude = latitudes.reduce((sum, lat) => sum + lat, 0) / latitudes.length;
        const centerLongitude = longitudes.reduce((sum, lon) => sum + lon, 0) / longitudes.length;

        // Calculate radius
        const radius = calculateRadius(latitudes, longitudes);

        // Convert centroid to DMS format
        const toDMS = (decimal) => {
            const absDecimal = Math.abs(decimal);
            const degrees = Math.floor(absDecimal);
            const minutes = Math.floor((absDecimal - degrees) * 60);
            const seconds = Math.round(((absDecimal - degrees) * 60 - minutes) * 60);
            return { degrees, minutes, seconds, sign: decimal < 0 ? '-' : '' };
        };

        const latDMS = toDMS(centerLatitude);
        const lonDMS = toDMS(centerLongitude);

        // Display results
        document.getElementById("output").innerHTML = `
            <p>
                <strong>Center:</strong> 
                <span id="center-display" style="cursor: pointer; color: red;">
                    ${Math.abs(latDMS.degrees)}°${latDMS.minutes}'${latDMS.seconds}"${centerLatitude < 0 ? 'S' : 'N'}, 
                ${Math.abs(lonDMS.degrees)}°${lonDMS.minutes}'${lonDMS.seconds}"${centerLongitude < 0 ? 'W' : 'E'}
                </span>. 
                <strong>Radius:</strong> ${radius.toFixed(2)} Nautical miles
            </p>
            <div id="format-options" style="display: none; margin-top: 10px; padding-left: 10px; border-left: 2px solid #ccc;">
                <p class="format-option" data-format="${centerLatitude.toFixed(6)}, ${centerLongitude.toFixed(6)}" style="cursor: pointer; color: red;">
                    ${centerLatitude.toFixed(6)}, ${centerLongitude.toFixed(6)}
                </p>
                <p class="format-option" data-format="${Math.abs(latDMS.degrees)}°${latDMS.minutes}'${centerLatitude < 0 ? 'S' : 'N'}, ${Math.abs(lonDMS.degrees)}°${lonDMS.minutes}'${centerLongitude < 0 ? 'W' : 'E'}" style="cursor: pointer; color: red;">
                    ${Math.abs(latDMS.degrees)}°${latDMS.minutes}'${centerLatitude < 0 ? 'S' : 'N'}, 
                    ${Math.abs(lonDMS.degrees)}°${lonDMS.minutes}'${centerLongitude < 0 ? 'W' : 'E'}
                </p>
                <p class="format-option" 
                data-format="${Math.abs(latDMS.degrees)}°${latDMS.minutes}'${latDMS.seconds}&quot;${centerLatitude < 0 ? 'S' : 'N'}, ${Math.abs(lonDMS.degrees)}°${lonDMS.minutes}'${lonDMS.seconds}&quot;${centerLongitude < 0 ? 'W' : 'E'}" 
                style="cursor: pointer; color: red;">
                ${Math.abs(latDMS.degrees)}°${latDMS.minutes}'${latDMS.seconds}"${centerLatitude < 0 ? 'S' : 'N'}, 
                ${Math.abs(lonDMS.degrees)}°${lonDMS.minutes}'${lonDMS.seconds}"${centerLongitude < 0 ? 'W' : 'E'}
                </p>
            </div>
        `;
        
        // Toggle dropdown visibility when the center is clicked
        document.getElementById("center-display").addEventListener("click", () => {
            const formatOptions = document.getElementById("format-options");
            formatOptions.style.display = formatOptions.style.display === "block" ? "none" : "block";
        });

        // Add event listener to update the display for all dropdown options
        document.getElementById("format-options").addEventListener("click", (event) => {
            if (event.target.classList.contains("format-option")) {
                const newFormat = event.target.getAttribute("data-format");
                updateCenterDisplay(newFormat);
            }
        });

        // Function to update the displayed center format
        function updateCenterDisplay(newFormat) {
            document.getElementById("center-display").innerText = newFormat;
            document.getElementById("format-options").style.display = "none"; // Close the dropdown
        }
        // Plot on map
                if (polygonLayer) map.removeLayer(polygonLayer);
                if (centerMarker) map.removeLayer(centerMarker);

                polygonLayer = L.polygon(coordinates, { color: 'blue' }).addTo(map);
                centerMarker = L.marker([centerLatitude, centerLongitude], { title: "Center" }).addTo(map);

                map.fitBounds(polygonLayer.getBounds());
            } catch (error) {
                alert(error.message);
            }
        }

        function calculateRadius(latitudes, longitudes) {
            const toRadians = (deg) => (deg * Math.PI) / 180;

            const haversineDistance = (lat1, lon1, lat2, lon2) => {
                const R = 3440.065; // Earth's radius in nautical miles
                const dLat = toRadians(lat2 - lat1);
                const dLon = toRadians(lon2 - lon1);
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c; // Distance in nautical miles
            };

            const centerLatitude = latitudes.reduce((sum, lat) => sum + lat, 0) / latitudes.length;
            const centerLongitude = longitudes.reduce((sum, lon) => sum + lon, 0) / longitudes.length;

            let maxDistance = 0;
            for (let i = 0; i < latitudes.length; i++) {
                const distance = haversineDistance(centerLatitude, centerLongitude, latitudes[i], longitudes[i]);
                if (distance > maxDistance) {
                    maxDistance = distance;
                }
            }

            return maxDistance;
        }
</script>

</body>
</html>
